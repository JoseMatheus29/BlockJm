services:
  mysql:
    image: mysql:8.0
    container_name: mysql1
    restart: always
    environment:
       MYSQL_ROOT_PASSWORD: admin123
       MYSQL_DATABASE: certificationdb
       MYSQL_USER: mysqluser
       MYSQL_PASSWORD: admin123
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql

  hardhat:
    image: node:18-alpine
    container_name: hardhat_node
    working_dir: /usr/src/app
    volumes:
      - ./:/usr/src/app
    command: npx hardhat node
    ports:
      - "8545:8545"

  backend:
    build: .
    container_name: certification_backend
    restart: on-failure
    env_file:
      - .env
    ports:
      - "3000:3000"
    environment:
      DATABASE_URL: ${DATABASE_URL}
      PRIVATE_KEY: ${PRIVATE_KEY}
      CONTRACT_ADDRESS: ${CONTRACT_ADDRESS}
      BLOCKCHAIN_RPC_URL: http://hardhat:8545
      PORT: ${PORT:-3000}
    depends_on:
      - mysql
      - hardhat

volumes:
  mysql_data:
